<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>سایت گروه چهار تلاش</title>
<link rel="icon" type="image/png" href="assets/img/گر4.png">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap');

  body {
    margin:0;
    background:#0fbf8b;
    font-family: 'Vazirmatn', sans-serif;
    text-align:center;
    color:#fff;
  }

  .top {
    background:#006c54;
    width:100%;
    padding:20px 0;
    border-radius:0 0 40px 40px;
    display:flex;
    justify-content:center;
    align-items:center;
  }
  .top img { width:120px; border-radius:50%; }

  .btn-box {
    margin-top:60px;
    display:flex;
    justify-content:space-around;
    padding:0 40px;
  }
  .btn {
    background:#006c54;
    padding:35px 45px;
    font-size:28px;
    border-radius:35px;
    cursor:pointer;
    transition:0.2s;
    font-family: 'Vazirmatn', sans-serif;
  }
  .btn:hover { transform:scale(1.05); }

  #countBox {
    margin-top:160px;
    background:#006c54;
    padding:30px 40px;
    font-size:30px;
    border-radius:30px;
    width:max-content;
    margin-left:auto;
    margin-right:auto;
    cursor:pointer;
    font-family: 'Vazirmatn', sans-serif;
  }

  .footer {
    margin-top:70px;
    font-size:22px;
    background:#006c54;
    padding:15px 30px;
    width:max-content;
    margin:auto;
    border-radius:20px;
    font-family: 'Vazirmatn', sans-serif;
  }

  /* پنجره لینک جلسات */
  #linkPanel {
    display:none;
    background:#004d3d;
    padding:25px;
    border-radius:25px;
    width:330px;
    margin:40px auto;
    font-family: 'Vazirmatn', sans-serif;
  }
  .copyBtn, .goBtn {
    background:#009b76;
    padding:14px 22px;
    border-radius:18px;
    margin:10px;
    font-size:20px;
    cursor:pointer;
    display:inline-block;
    font-family: 'Vazirmatn', sans-serif;
  }
  .copyBtn:hover, .goBtn:hover { transform:scale(1.07); }

  /* شمارشگر پاپ-آپ */
  #timerBox {
    display:none;
    background:#004d3d;
    padding:30px;
    border-radius:25px;
    width:360px;
    margin:40px auto;
    font-size:28px;
    font-family: 'Vazirmatn', sans-serif;
  }

@media (max-width:600px){
  .btn-box { flex-direction:column; gap:20px; padding:0 20px; margin-top:40px; }
  .btn { width:100%; padding:25px 0; font-size:22px; }
  #countBox { width:90%; font-size:22px; margin-top:60px; }
  #linkPanel,#timerBox { width:90%; font-size:20px; }
  .top img { width:90px; }
}
</style>
</head>
<body>

<div onclick="window.location.href='blog.html'"
style="position:fixed;bottom:60px;left:10px;background:#005f48;
padding:10px 18px;border-radius:15px;cursor:pointer;font-size:16px;
z-index:999;font-family:'Vazirmatn', sans-serif;">
  وبلاگچه
</div>

<div class="top">
  <img src="https://cdn.imgurl.ir/uploads/b50035_1759404615322_1.jpg" alt="لوگو" />
</div>

<div class="btn-box">
  <div class="btn" onclick="showLinks()">لینک جلسات</div>
  <div class="btn" onclick="showTeacherFile()">فایل آقا معلم</div>
</div>

<div id="countBox" onclick="showTimer()">شمارشگر معکوسی تا جلسه ی امروز</div>

<!-- پنل لینک‌ها -->
<div id="linkPanel">
  <div style="font-size:22px;margin-bottom:15px;">لینک جلسه</div>
  <div style="word-wrap:break-word;color:#aaffdd">
    https://engage.shatel.com/rooms/bun-gev-f2f-i2i/join
  </div>
  <div class="copyBtn" onclick="copyLink()">کپی لینک</div>
  <a class="goBtn" href="https://engage.shatel.com/rooms/bun-gev-f2f-i2i/join" target="_blank">ورود</a>
</div>

<!-- شمارشگر -->
<div id="timerBox">
  <div id="timerText">00:00:00</div>
</div>

<div class="footer">ساخته شده توسط علیرضا حاتمی</div>

<script>
  function showLinks() { document.getElementById('linkPanel').style.display='block'; document.getElementById('timerBox').style.display='none'; }
  function showTeacherFile() { window.location.href='https://cdn.imgurl.ir/uploads/s36153__.rar'; }
  function copyLink() { navigator.clipboard.writeText("https://engage.shatel.com/rooms/bun-gev-f2f-i2i/join"); alert('لینک کپی شد'); }
  function showTimer() { document.getElementById('timerBox').style.display='block'; document.getElementById('linkPanel').style.display='none'; }
//شمارشگر اصلی
  const target = new Date();
  target.setHours(00,0,0,0);

  function updateTimer(){
    let now = new Date();
    let diff = target - now;
    if(diff < 0) diff = 0;

    let h = String(Math.floor(diff/1000/60/60)).padStart(2,'0');
    let m = String(Math.floor(diff/1000/60)%60).padStart(2,'0');
    let s = String(Math.floor(diff/1000)%60).padStart(2,'0');

    document.getElementById('timerText').innerText = `${h}:${m}:${s}`;
  }

  setInterval(updateTimer,500);
  updateTimer();
</script>

<!-- بخش ورود بالا -->
<div id="topLogin" style="position:fixed;top:10px;left:10px;z-index:999;display:flex;gap:10px;align-items:center;font-family:'Vazirmatn', sans-serif;">
  <div onclick="openLogin()" style="background:#005f48;padding:10px 18px;border-radius:15px;cursor:pointer;font-size:18px;">ورود</div>
  <div onclick="openAdmin()" style="background:#004637;padding:10px 18px;border-radius:15px;cursor:pointer;font-size:18px;">ورود مدیر</div>
  <div id="profileBox" style="display:none;align-items:center;gap:10px;">
    <img id="profileImg" src="" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">
    <span id="profileName" style="font-size:18px;"></span>
    <div onclick="editProfile()" style="background:#008b6a;padding:6px 12px;border-radius:12px;cursor:pointer;font-size:15px;">ویرایش</div>
  </div>
</div>

<!-- پنجره ورود کاربر -->
<div id="loginPanel" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#004d3d;padding:25px;border-radius:25px;width:300px;text-align:center;z-index:1000;font-family:'Vazirmatn', sans-serif;">
  <h3>ورود</h3>
  <input id="nameInput" placeholder="نام" style="width:90%;padding:8px;border-radius:10px;border:none;margin-bottom:10px;">
  <input type="file" id="imgInput" accept="image/*" style="margin-bottom:15px;">
  <button onclick="saveUser()" style="background:#009b76;padding:10px 20px;border-radius:15px;border:none;color:#fff;cursor:pointer;">ذخیره</button>
</div>

<!-- پنجره ورود مدیر -->
<div id="adminPanel" style="display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#003a2c;padding:25px;border-radius:25px;width:300px;text-align:center;z-index:1000;font-family:'Vazirmatn', sans-serif;">
  <h3>ورود مدیر</h3>
  <input id="adminName" placeholder="نام" style="width:90%;padding:8px;border-radius:10px;border:none;margin-bottom:10px;">
  <input type="file" id="adminImg" accept="image/*" style="margin-bottom:10px;">
  <input id="adminCode" placeholder="کد ورود" style="width:90%;padding:8px;border-radius:10px;border:none;margin-bottom:10px;">
  <button onclick="saveAdmin()" style="background:#009b76;padding:10px 20px;border-radius:15px;border:none;color:#fff;cursor:pointer;">ورود</button>
</div>

<script>
function openLogin(){ document.getElementById('loginPanel').style.display='block'; }
function openAdmin(){ document.getElementById('adminPanel').style.display='block'; }

function saveUser(){
  let n=document.getElementById('nameInput').value;
  let f=document.getElementById('imgInput').files[0];
  if(!n||!f){alert('نام و عکس الزامیست');return;}
  let r=new FileReader();
  r.onload=function(){
    localStorage.setItem('userName',n);
    localStorage.setItem('userImg',r.result);
    showProfile();
  };
  r.readAsDataURL(f);
  document.getElementById('loginPanel').style.display='none';
}

function showProfile(){
  let n=localStorage.getItem('userName');
  let i=localStorage.getItem('userImg');
  if(n&&i){
    let box=document.getElementById('profileBox');
    box.style.display='flex';
    document.getElementById('profileName').innerText=n;
    document.getElementById('profileImg').src=i;
  }
}
showProfile();

function saveAdmin(){
  let n=document.getElementById('adminName').value;
  let f=document.getElementById('adminImg').files[0];
  let c=document.getElementById('adminCode').value;
  if(c!="134891"){alert('کد مدیریت اشتباه است');return;}
  let r=new FileReader();
  r.onload=function(){
    localStorage.setItem('adminName',n);
    localStorage.setItem('adminImg',r.result);
    localStorage.setItem('adminKey','hgpcej');
    showAdmin();
  };
  r.readAsDataURL(f);
  document.getElementById('adminPanel').style.display='none';
}

function showAdmin(){
  let n=localStorage.getItem('adminName');
  let i=localStorage.getItem('adminImg');
  let k=localStorage.getItem('adminKey');
  if(n&&i){
    let box=document.getElementById('profileBox');
    box.style.display='flex';
    document.getElementById('profileName').innerText=n+' ('+k+')';
    document.getElementById('profileImg').src=i;
  }
}
showAdmin();

function editProfile(){
  let box=document.createElement('div');
  box.style.position='fixed'; box.style.top='50%'; box.style.left='50%'; box.style.transform='translate(-50%,-50%)';
  box.style.background='#004d3d'; box.style.padding='25px'; box.style.borderRadius='25px'; box.style.width='300px'; box.style.textAlign='center'; box.style.zIndex='2000';
  box.innerHTML=`<h3>ویرایش پروفایل</h3>
    <input id='editName' placeholder='نام جدید' style='width:90%;padding:8px;border-radius:10px;border:none;margin-bottom:10px;'>
    <input type='file' id='editImg' accept='image/*' style='margin-bottom:10px;'>
    <button id='saveEditBtn' style='background:#009b76;padding:10px 20px;border-radius:15px;border:none;color:#fff;cursor:pointer;'>ذخیره</button>`;
  document.body.appendChild(box);
  document.getElementById('saveEditBtn').onclick=function(){
    let n=document.getElementById('editName').value;
    let f=document.getElementById('editImg').files[0];
    if(n) localStorage.setItem('userName',n);
    if(f){ let r=new FileReader(); r.onload=function(){localStorage.setItem('userImg',r.result);showProfile();}; r.readAsDataURL(f);} else {showProfile();}
    box.remove();
  };
}
</script>

<div id="iranClock" style="position:fixed;bottom:10px;left:10px;background:#004d3d;padding:6px 12px;border-radius:10px;font-size:14px;z-index:999;color:white;font-family:'Vazirmatn', sans-serif;"></div>
<script>
setInterval(()=>{
 let d=new Date();
 document.getElementById('iranClock').innerText = d.toLocaleTimeString('fa-IR',{hour12:false});
},1000);
</script>

<!-- وبلاگچه -->
<div id="blogContainer" style="padding:20px; display:none;">
    <h2 style="margin-bottom:10px;">وبلاگچه</h2>

    <!-- فرم ارسال پست فقط برای مدیر -->
    <div id="postForm" style="display:none; margin-bottom:20px;">
        <textarea id="postContent" placeholder="متن پست..." style="width:100%; height:120px;"></textarea><br><br>
        <input type="text" id="imageURL" placeholder="لینک عکس (اختیاری)" style="width:100%;"><br><br>
        <input type="text" id="fileURL" placeholder="لینک فایل (اختیاری)" style="width:100%;"><br><br>
        <button onclick="sendPost()" style="padding:8px 14px;">ارسال پست</button>
    </div>

    <div id="postsList"></div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabaseUrl = "https://xwibxxrqwcvilojadoig.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supabase = createClient(supabaseUrl, supabaseKey);

// ارسال پست
async function sendPost() {
    const content = document.getElementById("postContent").value;
    const imageURL = document.getElementById("imageURL").value;
    const fileURL = document.getElementById("fileURL").value;

    const author = localStorage.getItem("profileName") || "ناشناس";

    let { data, error } = await supabase.from("posts").insert({
        author,
        content,
        image_url: imageURL,
        file_url: fileURL
    });

    loadPosts();
}

// دریافت پست‌ها
async function loadPosts() {
    let { data: posts } = await supabase
        .from("posts")
        .select("*")
        .order("id", { ascending: false });

    let container = "";
    posts.forEach(post => {
        container += `
        <div style="background:#1e1e1e; padding:15px; margin-bottom:20px; border-radius:10px;">
            <strong>${post.author}</strong><br><br>
            <p>${post.content}</p>
            ${post.image_url ? `<img src="${post.image_url}" style="max-width:100%; border-radius:10px; margin-top:10px;">` : ""}
            ${post.file_url ? `<br><a href="${post.file_url}" download style="color:yellow;">دانلود فایل</a>` : ""}
            ${localStorage.getItem("isAdmin") === "true" ? `<br><br><button onclick="deletePost(${post.id})" style="padding:4px 8px; color:black;">حذف</button>` : ""}
        </div>`;
    });

    document.getElementById("postsList").innerHTML = container;
}

// حذف پست
window.deletePost = async function(id) {
    await supabase.from("posts").delete().eq("id", id);
    loadPosts();
}

window.openBlog = openBlog;
window.sendPost = sendPost;
</script>

</body>
</html>
