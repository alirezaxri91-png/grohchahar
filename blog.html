<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ÙˆØ¨Ù„Ø§Ú¯Ú†Ù‡</title>

<style>
    body {
        font-family: sans-serif;
        background: #111;
        color: white;
        margin: 0;
        padding: 15px;
    }

    .post-box {
        background: #1d1d1d;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
    }

    textarea, input {
        width: 100%;
        padding: 10px;
        border-radius: 8px;
        border: none;
        outline: none;
        margin-top: 10px;
        background: #222;
        color: white;
    }

    button {
        padding: 8px 14px;
        border: none;
        background: yellow;
        color: black;
        border-radius: 8px;
        margin-top: 10px;
        cursor: pointer;
    }

    img {
        width: 100%;
        max-width: 500px;
        border-radius: 10px;
        margin-top: 10px;
    }
</style>

</head>
<body>

<h2>ÙˆØ¨Ù„Ø§Ú¯Ú†Ù‡</h2>
<p>Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§Øª Ø±Ùˆ Ø¨Ø§ Ø¨Ù‚ÛŒÙ‡ Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ø²Ø§Ø±ÛŒ ğŸ˜ŠğŸ”¥</p>

<!-- ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±) -->
<div id="postForm" style="display:none;">
    <textarea id="postContent" placeholder="Ù…ØªÙ† Ù¾Ø³Øª..."></textarea>
    <input type="text" id="imageURL" placeholder="Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
    <input type="text" id="fileURL" placeholder="Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
    <button onclick="sendPost()">Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª</button>
</div>

<br>

<!-- Ù„ÛŒØ³Øª Ù¾Ø³Øªâ€ŒÙ‡Ø§ -->
<div id="postsList"></div>


<!-- Ø§ØªØµØ§Ù„ Supabase -->
<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

const supabaseUrl = "https://xwibxxrqwcvilojadoig.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...";
const supabase = createClient(supabaseUrl, supabaseKey);

// Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª Ø§Ú¯Ø± Ù…Ø¯ÛŒØ± Ø¨Ø§Ø´Ø¯
if (localStorage.getItem("isAdmin") === "true") {
    document.getElementById("postForm").style.display = "block";
}

// Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª
async function sendPost() {
    const content = document.getElementById("postContent").value;
    const imageURL = document.getElementById("imageURL").value;
    const fileURL = document.getElementById("fileURL").value;

    const author = localStorage.getItem("profileName") || "Ù†Ø§Ø´Ù†Ø§Ø³";

    await supabase.from("posts").insert({
        author,
        content,
        image_url: imageURL,
        file_url: fileURL
    });

    loadPosts();
}

// Ù†Ù…Ø§ÛŒØ´ Ù¾Ø³Øªâ€ŒÙ‡Ø§
async function loadPosts() {
    let { data: posts } = await supabase
        .from("posts")
        .select("*")
        .order("id", { ascending: false });

    let html = "";

    posts.forEach(post => {
        html += `
        <div class="post-box">
            <strong>${post.author}</strong><br><br>
            <p>${post.content}</p>

            ${post.image_url ? `<img src="${post.image_url}">` : ""}

            ${post.file_url ? `
                <br><a href="${post.file_url}" download
                style="color:yellow;">Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„</a>` : ""}

            ${localStorage.getItem("isAdmin") === "true" ? `
                <br><br>
                <button onclick="deletePost(${post.id})">Ø­Ø°Ù</button>
            ` : ""}
        </div>
        `;
    });

    document.getElementById("postsList").innerHTML = html;
}

// Ø­Ø°Ù Ù¾Ø³Øª
window.deletePost = async function(id) {
    await supabase.from("posts").delete().eq("id", id);
    loadPosts();
}

loadPosts();
</script>

</body>
</html>
