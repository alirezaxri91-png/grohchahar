<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ÙˆØ¨Ù„Ø§Ú¯Ú†Ù‡ Ø®ÙÙ†</title>

<!-- ÙÙˆÙ†Øª ÙˆØ²ÛŒØ± -->
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">

<style>
body {
    font-family: 'Vazirmatn', sans-serif;
    margin:0;
    background: linear-gradient(135deg, #0fbf8b, #006c54);
    color:white;
    text-align:center;
}

h2 {
    margin-top:20px;
    font-size:32px;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
}

p {
    font-size:16px;
    margin-bottom:30px;
}

.container {
    width:95%;
    max-width:700px;
    margin:auto;
}

input, textarea {
    width:100%;
    padding:12px;
    border-radius:12px;
    border:none;
    outline:none;
    margin-top:10px;
    background:#004d3d;
    color:white;
    font-size:16px;
    transition:0.3s;
}

input:focus, textarea:focus {
    background:#006c54;
}

button {
    padding:10px 20px;
    border:none;
    border-radius:12px;
    background: yellow;
    color:black;
    font-weight:bold;
    font-size:16px;
    margin-top:10px;
    cursor:pointer;
    transition:0.3s;
}

button:hover {
    transform:scale(1.05);
    background:#ffd700;
}

.post-box {
    background: rgba(0,77,61,0.9);
    padding:15px;
    border-radius:15px;
    margin-bottom:20px;
    text-align:right;
    box-shadow:0 4px 8px rgba(0,0,0,0.3);
    animation:fadeIn 0.5s ease;
}

.post-box img {
    width:100%;
    max-width:500px;
    border-radius:10px;
    margin-top:10px;
}

a.download-link {
    color:yellow;
    text-decoration:none;
    font-weight:bold;
}

a.download-link:hover { text-decoration:underline; }

#adminLogin, #postForm {
    background: rgba(0,77,61,0.9);
    padding:20px;
    border-radius:15px;
    margin-bottom:30px;
    box-shadow:0 4px 8px rgba(0,0,0,0.3);
}

@keyframes fadeIn {
    from {opacity:0; transform: translateY(20px);}
    to {opacity:1; transform: translateY(0);}
}

</style>
</head>
<body>
<h2>ÙˆØ¨Ù„Ø§Ú¯Ú†Ù‡ Ø®ÙÙ† Ú¯Ø±ÙˆÙ‡ Ú†Ù‡Ø§Ø± ØªÙ„Ø§Ø´</h2>
<p>Ø§ÛŒÙ†Ø¬Ø§ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§ØŒ Ø¹Ú©Ø³â€ŒÙ‡Ø§ Ùˆ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§Øª Ø±Ùˆ Ø¨Ø§ Ø¯ÙˆØ³ØªØ§Ù†Øª Ø¨Ù‡ Ø§Ø´ØªØ±Ø§Ú© Ø¨Ø²Ø§Ø±ÛŒ ğŸ”¥</p>

<div class="container">
<!-- ÙØ±Ù… ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ± -->
<div id="adminLogin">
    <input type="text" id="adminName" placeholder="Ù†Ø§Ù… Ù…Ø¯ÛŒØ±">
    <input type="text" id="adminCode" placeholder="Ú©Ø¯ ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±">
    <button onclick="loginAdmin()">ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±</button>
</div>

<!-- ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª -->
<div id="postForm" style="display:none;">
    <textarea id="postContent" placeholder="Ù…ØªÙ† Ù¾Ø³Øª..."></textarea>
    <input type="text" id="imageURL" placeholder="Ù„ÛŒÙ†Ú© Ø¹Ú©Ø³ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
    <input type="text" id="fileURL" placeholder="Ù„ÛŒÙ†Ú© ÙØ§ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)">
    <button onclick="sendPost()">Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª</button>
</div>

<!-- Ù„ÛŒØ³Øª Ù¾Ø³Øªâ€ŒÙ‡Ø§ -->
<div id="postsList"></div>
</div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js";

// Ø§Ø·Ù„Ø§Ø¹Ø§Øª Supabase
const supabaseUrl = "https://xwibxxrqwcvilojadoig.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inh3aWJ4eHJxd2N2aWxvamFkb2lnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzMTU3OTEsImV4cCI6MjA3OTg5MTc5MX0.FLzjzpvlVHHtfvxUYBzFlxzKoSK8Hu5vi-3HosG8Izw";
const supabase = createClient(supabaseUrl, supabaseKey);

// ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±
window.loginAdmin = async function() {
    const name = document.getElementById("adminName").value.trim();
    const code = document.getElementById("adminCode").value.trim();

    if(!name || !code) { alert("Ù„Ø·ÙØ§ Ù†Ø§Ù… Ùˆ Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯"); return; }

    if(code === "134891") {
        localStorage.setItem("isAdmin","true");
        localStorage.setItem("profileName", name);
        document.getElementById("postForm").style.display = "block";
        document.getElementById("adminLogin").style.display = "none";
        alert("ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ± Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯!");
    } else {
        alert("Ú©Ø¯ ÙˆØ±ÙˆØ¯ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª!");
    }
}

// Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù… Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§ Ù„Ø§Ú¯ÛŒÙ† Ø´Ø¯Ù‡
window.addEventListener("load",()=>{
    if(localStorage.getItem("isAdmin")==="true") {
        document.getElementById("postForm").style.display="block";
        document.getElementById("adminLogin").style.display="none";
    }
});

// Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª
window.sendPost = async function() {
    const content = document.getElementById("postContent").value.trim();
    const imageURL = document.getElementById("imageURL").value.trim();
    const fileURL = document.getElementById("fileURL").value.trim();
    const author = localStorage.getItem("profileName") || "Ù†Ø§Ø´Ù†Ø§Ø³";

    if(!content) { alert("Ù…ØªÙ† Ù¾Ø³Øª Ø®Ø§Ù„ÛŒÙ‡"); return; }

    await supabase.from("posts").insert({
        author, content, image_url:imageURL || null, file_url:fileURL || null
    });

    // Ø®Ø§Ù„ÛŒ Ú©Ø±Ø¯Ù† ÙØ±Ù…
    document.getElementById("postContent").value="";
    document.getElementById("imageURL").value="";
    document.getElementById("fileURL").value="";
    
    loadPosts();
}

// Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø³Øªâ€ŒÙ‡Ø§
async function loadPosts() {
    let { data: posts } = await supabase.from("posts").select("*").order("id",{ascending:false});
    let html = "";
    posts.forEach(post=>{
        html += `
        <div class="post-box">
            <strong>${post.author}</strong><br><br>
            <p>${post.content}</p>
            ${post.image_url ? `<img src="${post.image_url}">` : ""}
            ${post.file_url ? `<br><a class="download-link" href="${post.file_url}" download>Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„</a>` : ""}
            ${localStorage.getItem("isAdmin")==="true" ? `<br><br><button onclick="deletePost(${post.id})">Ø­Ø°Ù</button>` : ""}
        </div>`;
    });
    document.getElementById("postsList").innerHTML = html;
}

// Ø­Ø°Ù Ù¾Ø³Øª
window.deletePost = async function(id) {
    if(confirm("Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø­Ø°Ù Ø¨Ø´Ù‡ØŸ")){
        await supabase.from("posts").delete().eq("id",id);
        loadPosts();
    }
}

loadPosts();

</script>
</body>
</html>
